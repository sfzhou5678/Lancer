(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e,t,n){e.exports=n(57)},32:function(e,t,n){},36:function(e,t,n){},57:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),o=n(8),i=n.n(o),c=(n(32),n(3)),s=n.n(c),l=n(11),u=n(5),d=n(16),h=n(17),f=n(25),p=n(18),v=n(26),g=(n(36),n(6)),m=(n(38),{nodeMap:new Map,relationMap:new Map,nodeGroupSet:new Set,cumulatedData:{nodes:[],links:[],rootNodes:[]}}),b=function(e,t){(t?m.cumulatedData.links:m.cumulatedData.nodes).push(e)},x={id:"default".concat(Date.now()),name:"this node is not found"},y={fetchData:function(){var e=Object(u.a)(s.a.mark(function e(){var t,n,a,r,o,i,c,l,u,d,h,f,p,v,y,k,w,S,M,N,D,G,O,E,C,F,j,L,I,T,R,W,z,P,_,A,H,B,V;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:8080/full_graph");case 2:return t=e.sent,e.next=5,t.text();case 5:n=e.sent,a=n.split(/\n/),r=0,o=!0,i=!1,c=void 0,e.prev=11,l=a[Symbol.iterator]();case 13:if(o=(u=l.next()).done){e.next=45;break}if(""!==(d=u.value)){e.next=17;break}return e.abrupt("continue",42);case 17:if(!d.startsWith("split")){e.next=20;break}return r+=1,e.abrupt("continue",42);case 20:if(1!==r){e.next=35;break}if(3===(h=d.split(/\t/)).length){e.next=24;break}throw Error("wrong data format encountered: ".concat(d));case 24:if(f=h.map(function(e){return e.trim()}),p=Object(g.a)(f,3),v=p[0],y=p[1],k=p[2],w={source:v,target:k,relation:y,value:4},m.nodeMap.has(v)){e.next=28;break}return e.abrupt("continue",42);case 28:if(m.nodeMap.has(k)){e.next=30;break}return e.abrupt("continue",42);case 30:if(m.relationMap.has(y)){e.next=32;break}return e.abrupt("continue",42);case 32:b(w,!0),e.next=42;break;case 35:if(0!==r){e.next=42;break}if(3===(S=d.split(/\t/)).length){e.next=39;break}throw Error("wrong data format encountered: ".concat(d));case 39:M=S.map(function(e){return e.trim()}),N=Object(g.a)(M,3),D=N[0],G=N[1],O=N[2],E={id:D,name:G,synonym:O},D.startsWith("R")?m.relationMap.set(D,E):(m.nodeGroupSet.add(D.charAt(0)),m.nodeMap.set(D,E),b(E,!1));case 42:o=!0,e.next=13;break;case 45:e.next=51;break;case 47:e.prev=47,e.t0=e.catch(11),i=!0,c=e.t0;case 51:e.prev=51,e.prev=52,o||null==l.return||l.return();case 54:if(e.prev=54,!i){e.next=57;break}throw c;case 57:return e.finish(54);case 58:return e.finish(51);case 59:for(C=!0,F=!1,j=void 0,e.prev=62,L=m.nodeMap[Symbol.iterator]();!(C=(I=L.next()).done);C=!0)T=I.value,R=Object(g.a)(T,2),W=R[0],R[1]===x&&(console.warn("key:".concat(W," has no related entity")),z={id:s=W,name:s},m.cumulatedData.rootNodes.push(z),m.cumulatedData.nodes.push(z),b(z,!1));e.next=70;break;case 66:e.prev=66,e.t1=e.catch(62),F=!0,j=e.t1;case 70:e.prev=70,e.prev=71,C||null==L.return||L.return();case 73:if(e.prev=73,!F){e.next=76;break}throw j;case 76:return e.finish(73);case 77:return e.finish(70);case 78:for(P=!0,_=!1,A=void 0,e.prev=81,H=m.cumulatedData.links[Symbol.iterator]();!(P=(B=H.next()).done);P=!0)(V=B.value).entity=m.relationMap.get(V.relation);e.next=89;break;case 85:e.prev=85,e.t2=e.catch(81),_=!0,A=e.t2;case 89:e.prev=89,e.prev=90,P||null==H.return||H.return();case 92:if(e.prev=92,!_){e.next=95;break}throw A;case 95:return e.finish(92);case 96:return e.finish(89);case 97:case"end":return e.stop()}var s},e,this,[[11,47,51,59],[52,,54,58],[62,66,70,78],[71,,73,77],[81,85,89,97],[90,,92,96]])}));return function(){return e.apply(this,arguments)}}(),getCurrentData:function(){return m.cumulatedData},getRelationMap:function(){return m.relationMap},getNodeGroupSet:function(){return m.nodeGroupSet}},k=(n(39),n(19)),w=n.n(k),S=(n(44),n(20)),M=n.n(S),N=n(24),D=n(55),G=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(f.a)(this,Object(p.a)(t).call(this))).state={isDataLoaded:!1,selectOptions:[],selectedOption:null,globalGraph:{emitter:null,isSelected:!1,selectedData:[],subGraph:{nodes:[],links:[],rootNodes:[]},toFocus:null},selectionHistory:{selectedState:[],currentSelectedIndex:0},depth:3,toFocus:"",toFocusMain:"",toFocusNode:null,mainClearSelectionFunc:null,linkTipPara:{top:0,left:0,isVisible:!1,content:""},fullScreenNotification:null,canvasSize:{canvasHeight:800,canvasWidth:1800}},e.init=Object(u.a)(s.a.mark(function t(){var n,a,r,o,i,c,u,d,h,f,p,v,g,m,b,x,k,w,S,M;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.state.fullScreenNotification="\u52a0\u8f7d\u6570\u636e\u4e2d",t.next=3,y.fetchData();case 3:return t.next=5,y.getCurrentData();case 5:for(n=t.sent,a=n.nodes,r=n.links,o=new Map,i=new Map,c=new Map,u=!0,d=!1,h=void 0,t.prev=14,f=a[Symbol.iterator]();!(u=(p=f.next()).done);u=!0)v=p.value,o.set(v.name,v),i.set(v.id,v);t.next=22;break;case 18:t.prev=18,t.t0=t.catch(14),d=!0,h=t.t0;case 22:t.prev=22,t.prev=23,u||null==f.return||f.return();case 25:if(t.prev=25,!d){t.next=28;break}throw h;case 28:return t.finish(25);case 29:return t.finish(22);case 30:for(g=function(e,t){c.has(e)?c.set(e,c.get(e).concat(t)):c.set(e,[t])},m=!0,b=!1,x=void 0,t.prev=34,k=r[Symbol.iterator]();!(m=(w=k.next()).done);m=!0)S=w.value,g(S.source,S.target),g(S.target,S.source);t.next=42;break;case 38:t.prev=38,t.t1=t.catch(34),b=!0,x=t.t1;case 42:t.prev=42,t.prev=43,m||null==k.return||k.return();case 45:if(t.prev=45,!b){t.next=48;break}throw x;case 48:return t.finish(45);case 49:return t.finish(42);case 50:e.state.name2Node=o,e.state.id2RelatedIds=c,e.state.id2Node=i,console.log(o,c,i),M=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"random",n=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"random"),a=new Map,r=Object(l.a)(e.keys()),o=D({count:r.length,luminosity:t,hue:n}),i=0;i<r.length;++i)a.set(r[i],o[i]);return a},e.state.relation2color=M(y.getRelationMap(),"random",3,"#00FFFF"),e.state.nodeGroup2color=M(y.getNodeGroupSet(),"dark",2),console.log("relation2color=",e.state.relation2color,"nodeGroup2color=",e.state.nodeGroup2color),e.state.fullScreenNotification=null;case 59:case"end":return t.stop()}},t,this,[[14,18,22,30],[23,,25,29],[34,38,42,50],[43,,45,49]])})),e.handleSelectChange=function(t){e.setState({selectedOption:t}),console.log("Option selected:",t),e.forceUpdate()},e.getGraphDataBySelected=function(){return y.getCurrentData()},e.focusOnMain=function(){console.log("focusOn called, ".concat(e.state.toFocusMain)),e.state.toFocusNode=e.state.toFocusMain;var t={},n=e.state.toFocusMain,a=e.state.depth,r=e.state.name2Node.get(n);if(r){for(var o=r.id,i=new Set([o]),c=[o],s=0;s<a&&c.length>0;++s){for(var u=[],d=0;d<c.length;d++){var h=c[d],f=e.state.id2Node.get(h);f&&(u=u.concat(e.state.id2RelatedIds.get(f.id)||[]))}var p=!0,v=!1,g=void 0;try{for(var m,b=u[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var x=m.value;i.add(x)}}catch(k){v=!0,g=k}finally{try{p||null==b.return||b.return()}finally{if(v)throw g}}c=u}t.nodes=Object(l.a)(i.values()).map(function(t){return e.state.id2Node.get(t)}).filter(function(e){return e}),t.links=y.getCurrentData().links.filter(function(e){return(i.has(e.source)||e.source&&i.has(e.source.id))&&(i.has(e.target)||e.target&&i.has(e.target.id))}),e.state.globalGraph.subGraph=t,console.log("subGraph=",t),e.forceUpdate()}},e.getDepth=function(){return e.state.depth},e.generateNodeLabel=function(e){return"<div><span>\u540d\u79f0: ".concat(e.name,"</span><br><span>id:").concat(e.id,"</span></div>")},e.generateLinkLabel=function(e){var t=(y.getRelationMap().get(e.relation)||{name:"\u672a\u6307\u5b9a"}).name;return"<div><span>\u540d\u79f0: ".concat(t,"</span><br><span>id:").concat(e.relation,"</span></div>")},e.init().then(),e}return Object(v.a)(t,e),Object(h.a)(t,[{key:"_onMouseMove",value:function(e){this.setState({mouseLocation:{x:e.screenX,y:e.screenY}})}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){var t=e.refs.myImgContainer,n=t.clientHeight,a=t.clientWidth;e.state.canvasSize={canvas_height:n-50,canvas_width:a-50},e.setState({canvasSize:e.state.canvasSize}),console.log(n,a)},1e3)}},{key:"render",value:function(){var e=this,t=this.state.canvasSize,n=t.canvas_width,a=t.canvas_height;return r.a.createElement("div",{className:"App",onMouseMove:this._onMouseMove.bind(this)},r.a.createElement("div",null,r.a.createElement("p",{style:{display:"inline-block"}},"\u8282\u70b9\u62d3\u5c55\u6df1\u5ea6:"),r.a.createElement("input",{placeholder:"\u8282\u70b9\u62d3\u5c55\u6df1\u5ea6",min:0,max:5,value:this.state.depth,type:"number",onChange:function(t){var n=parseInt(t.target.value);e.setState({depth:Math.min(Math.max(n,0),5)})},style:{height:"30px"}}),r.a.createElement("p",{style:{display:"inline-block"}},"\u8282\u70b9\u9009\u62e9:"),r.a.createElement(M.a,{getItemValue:function(e){return e.name},items:y.getCurrentData().nodes,renderItem:function(e,t){return r.a.createElement("div",{style:{background:t?"lightgray":"white"},key:e.id},"".concat(e.name," | ").concat(e.id))},value:this.state.toFocusMain,onChange:function(t){e.setState({toFocusMain:t.target.name})},onSelect:function(t){e.setState({toFocusMain:t})},inputProps:{style:{height:"30px"}},menuStyle:{borderRadius:"3px",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.1)",background:"rgba(255, 255, 255, 0.9)",padding:"2px 0",fontSize:"90%",position:"fixed",overflow:"auto",maxHeight:"50%",zIndex:"10"}}),r.a.createElement(w.a,{color:"primary",onClick:function(){e.focusOnMain()}},"\u5b9a\u4f4d")),r.a.createElement("div",{ref:"myImgContainer",style:{width:"100%",height:"95%"}},r.a.createElement(N.a,{width:n,height:a,graphData:this.state.globalGraph.subGraph,nodeCanvasObject:function(t,n,a){var r=12/a,o=4.5*r;t.bestCircleR=o;!function(){n.beginPath(),n.arc(t.x,t.y,1.05*o,0,2*Math.PI,!1);var a=t.id.charAt(0);n.fillStyle=e.state.nodeGroup2color.get(a)||"black",n.fill(),n.beginPath(),n.arc(t.x,t.y,o,0,2*Math.PI,!1),n.fillStyle="white",n.fill()}();!function(){var e=t.name;n.font="".concat(r,"px Sans-Serif");n.measureText(e).width;n.textAlign="center",n.textBaseline="middle",n.fillStyle="black",n.fillText(e,t.x,t.y)}()},linkColor:function(t){return e.state.relation2color.get(t.relation)},ref:function(t){e.fg=t},cooldownTime:3e3,onEngineTick:function(){0!==e.state.globalGraph.subGraph.nodes.length&&e.setState({fullScreenNotification:"\u529b\u56fe\u8ba1\u7b97\u4e2d"})},onEngineStop:function(){console.log("onEngineStop");var t=e.state.globalGraph.subGraph.nodes;if(0!==t.length){var r=t[0].x,o=t[0].x,i=t[0].y,c=t[0].y,s=!0,l=!1,u=void 0;try{for(var d,h=t[Symbol.iterator]();!(s=(d=h.next()).done);s=!0){var f=d.value;r=Math.min(r,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),c=Math.max(c,f.y)}}catch(M){l=!0,u=M}finally{try{s||null==h.return||h.return()}finally{if(l)throw u}}var p=n/(o-r),v=a/(c-i),g=.9*Math.min(p,v);1!==t.length&&e.fg.zoom(g);var m=!0,b=!1,x=void 0;try{for(var y,k=t[Symbol.iterator]();!(m=(y=k.next()).done);m=!0){var w=y.value;r=Math.min(r,w.x),i=Math.min(i,w.y),o=Math.max(o,w.x),c=Math.max(c,w.y)}}catch(M){b=!0,x=M}finally{try{m||null==k.return||k.return()}finally{if(b)throw x}}var S={x:(r+o)/2,y:(i+c)/2};e.fg.centerAt(S.x,S.y),e.setState({fullScreenNotification:null})}},linkLabel:this.generateLinkLabel,nodeLabel:this.generateNodeLabel,onLinkHover:function(t){t?e.setState({linkTipPara:{top:e.state.mouseLocation.y,left:e.state.mouseLocation.x,isVisible:!0,content:null}}):e.setState({linkTipPara:{isVisible:!1}})},enableNodeDrag:!1}),this.state.fullScreenNotification&&r.a.createElement("div",{className:"center-screen"},this.state.fullScreenNotification)))}}]),t}(a.Component),O=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function E(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(r.a.createElement(G,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");O?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):E(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):E(e)})}}()}},[[27,2,1]]]);
//# sourceMappingURL=main.ce1791a0.chunk.js.map